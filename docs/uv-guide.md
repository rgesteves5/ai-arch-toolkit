# Development with uv

This project uses [uv](https://docs.astral.sh/uv/) for package management,
virtual environments, and script execution.

## Installing uv

```bash
# macOS / Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# macOS via Homebrew
brew install uv

# Verify
uv --version
```

## First-time Setup

```bash
# Install all dependencies (creates .venv/ automatically)
uv sync --dev
```

That's it. `uv sync` reads `pyproject.toml`, resolves dependencies using
`uv.lock`, creates a `.venv/` in the project root, and installs everything —
typically in under a second.

## Daily Commands

### Running code

```bash
# Run any Python script
uv run python examples/01_hello_world.py

# Run a module
uv run python -m ai_arch_toolkit

# Run a tool directly
uv run pytest
uv run ruff check src/
```

`uv run` automatically activates the project's virtual environment. You never
need to manually run `source .venv/bin/activate`.

### Managing dependencies

```bash
# Add a production dependency
uv add httpx

# Add a dev dependency
uv add --dev pytest-cov

# Remove a dependency
uv remove httpx

# Update all dependencies to latest compatible versions
uv lock --upgrade
uv sync --dev
```

Changes are written to `pyproject.toml` and `uv.lock` automatically.

### Linting and formatting

```bash
# Lint (check only)
uv run ruff check src/ tests/ examples/

# Lint with auto-fix
uv run ruff check --fix src/ tests/ examples/

# Format (check only)
uv run ruff format --check src/ tests/ examples/

# Format (apply)
uv run ruff format src/ tests/ examples/
```

### Testing

```bash
# Run all tests
uv run pytest

# Run with verbose output
uv run pytest -v

# Run a specific file
uv run pytest tests/llm/test_providers/test_gemini.py

# Run with coverage
uv run pytest --cov=src --cov-report=term-missing

# Run only tests matching a pattern
uv run pytest -k "test_stream"
```

### Python version management

```bash
# Install a specific Python version
uv python install 3.13

# Use a specific version for this project
uv python pin 3.13
```

## Key Files

| File | Purpose |
|---|---|
| `pyproject.toml` | Project metadata, dependencies, tool config |
| `uv.lock` | Pinned dependency versions (commit this) |
| `.venv/` | Virtual environment (gitignored) |

## Tips

- **Never edit `uv.lock` manually** — it's auto-generated by `uv lock`.
- **Commit `uv.lock`** — it ensures reproducible installs across machines.
- **No need to activate the venv** — `uv run` handles it.
- **Install is near-instant** — uv caches packages aggressively and resolves
  in Rust, so `uv sync` typically runs in under a second.

## Migrating from Poetry

If you previously used Poetry with this project:

```bash
# Remove Poetry artifacts
rm -f poetry.lock

# Install with uv instead
uv sync --dev

# Replace "poetry run X" with "uv run X" everywhere
```

The `pyproject.toml` uses standard PEP 621 metadata and `hatchling` as the
build backend, so no changes to `pyproject.toml` are needed.
